# ğŸ“– é¡¹ç›®æ–‡æ¡£ç´¢å¼•

**å¿«é€Ÿå¯¼èˆª**ï¼šæ ¹æ®æ‚¨çš„éœ€æ±‚é€‰æ‹©å¯¹åº”æ–‡æ¡£

---

## ğŸš€ æˆ‘æƒ³ç«‹å³å¼€å§‹

ğŸ‘‰ **[QUICKSTART.md](QUICKSTART.md)**
- ä¸€é”®ä¸‰æ­¥å‘½ä»¤
- é¢„æœŸè¾“å‡ºç¤ºä¾‹
- å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

**æœ€å¿«è·¯å¾„**ï¼š
```bash
pip install -r requirements.txt
bash scripts/run_mnli.sh 1
bash scripts/measure_mnli.sh 1
bash scripts/make_plots.sh 1
```

---

## ğŸ“š æˆ‘æƒ³äº†è§£å®Œæ•´é¡¹ç›®

ğŸ‘‰ **[README.md](README.md)**
- å®Œæ•´é¡¹ç›®è¯´æ˜
- ç¯å¢ƒè¦æ±‚ä¸å®‰è£…
- è¾“å‡ºè¯´æ˜ï¼ˆè¯¦ç»†è¡¨æ ¼ï¼‰
- éªŒæ”¶æ ‡å‡†ï¼ˆæ•°å€¼ + å¯è§†åŒ–ï¼‰
- å¸¸è§é—®é¢˜æ’æŸ¥ï¼ˆ6 ä¸ªåœºæ™¯ï¼‰
- æŠ€æœ¯ç»†èŠ‚ï¼ˆæ¨¡å‹ç»“æ„ã€å…¬å¼ï¼‰

**é€‚åˆåœºæ™¯**ï¼š
- ç¬¬ä¸€æ¬¡ä½¿ç”¨é¡¹ç›®
- éœ€è¦ç†è§£æŠ€æœ¯åŸç†
- é‡åˆ°é”™è¯¯éœ€è¦æ’æŸ¥

---

## âœ… æˆ‘æƒ³éªŒè¯é¡¹ç›®å®Œæ•´æ€§

ğŸ‘‰ **[CHECKLIST.md](CHECKLIST.md)**
- æ–‡ä»¶æ¸…å•ï¼ˆ27 ä¸ªæ–‡ä»¶é€ä¸€å‹¾é€‰ï¼‰
- åŠŸèƒ½éªŒè¯ï¼ˆæ•°æ®ã€æ¨¡å‹ã€è®­ç»ƒã€æµ‹é‡ã€åˆ†æï¼‰
- æµ‹è¯•æ­¥éª¤ï¼ˆç¯å¢ƒã€è®­ç»ƒã€æµ‹é‡ã€å¯è§†åŒ–ï¼‰
- éªŒæ”¶æ ‡å‡†ï¼ˆæ•°æ®å®Œæ•´æ€§ã€æ•°å€¼åˆç†æ€§ï¼‰

**é€‚åˆåœºæ™¯**ï¼š
- éªŒè¯æ‰€æœ‰æ–‡ä»¶æ˜¯å¦é½å…¨
- æ£€æŸ¥å®éªŒæ˜¯å¦æˆåŠŸ
- ç¡®è®¤è¾“å‡ºæ˜¯å¦ç¬¦åˆé¢„æœŸ

---

## ğŸ“ æˆ‘æƒ³æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶è¯´æ˜

ğŸ‘‰ **[PROJECT_FILES.md](PROJECT_FILES.md)**
- å®Œæ•´æ–‡ä»¶åˆ—è¡¨ï¼ˆ27 ä¸ªï¼‰
- æ¯ä¸ªæ–‡ä»¶çš„ç”¨é€”è¯´æ˜
- æ–‡ä»¶çŠ¶æ€æ ‡æ³¨ï¼ˆâœ… å·²æœ‰ / âœ¨ æ–°å¢ / âœ… å·²ä¿®æ­£ï¼‰
- è¾“å‡ºæ–‡ä»¶è¯´æ˜ï¼ˆ15 ä¸ªæ–‡ä»¶ï¼‰

**é€‚åˆåœºæ™¯**ï¼š
- äº†è§£é¡¹ç›®ç»“æ„
- æŸ¥æ‰¾ç‰¹å®šåŠŸèƒ½çš„ä»£ç ä½ç½®
- ç†è§£æ¯ä¸ªæ–‡ä»¶çš„ä½œç”¨

---

## ğŸ“Š æˆ‘æƒ³äº†è§£é¡¹ç›®ç”Ÿæˆæƒ…å†µ

ğŸ‘‰ **[SUMMARY.md](SUMMARY.md)**
- ç”Ÿæˆå†…å®¹æ¦‚è§ˆï¼ˆæ–‡ä»¶ç»Ÿè®¡ã€æ ¸å¿ƒåŠŸèƒ½ï¼‰
- å…³é”®æ”¹è¿›è¯´æ˜ï¼ˆä¿®æ­£å†…å®¹ã€æ–°å¢æ–‡ä»¶ï¼‰
- æŠ€æœ¯è¦ç‚¹ï¼ˆæ¨¡å‹ç»“æ„ã€åˆ‡ç‰‡é€»è¾‘ã€å…¬å¼ï¼‰
- ä½¿ç”¨æµç¨‹ï¼ˆä¸€é”®ä¸‰æ­¥è¯¦è§£ï¼‰
- éªŒæ”¶æ ‡å‡†ï¼ˆå¿…è¾¾æŒ‡æ ‡ï¼‰
- è´¨é‡ä¿è¯ï¼ˆä»£ç è´¨é‡ã€å…¼å®¹æ€§ã€å¥å£®æ€§ï¼‰

**é€‚åˆåœºæ™¯**ï¼š
- å®¡æŸ¥é¡¹ç›®äº¤ä»˜å†…å®¹
- äº†è§£æŠ€æœ¯å®ç°ç»†èŠ‚
- æŸ¥çœ‹è´¨é‡ä¿è¯æªæ–½

---

## ğŸ”§ æˆ‘æƒ³æµ‹è¯•ç¯å¢ƒæ˜¯å¦æ­£å¸¸

ğŸ‘‰ **è¿è¡Œæµ‹è¯•è„šæœ¬**ï¼š
```bash
python test_setup.py
```

**æµ‹è¯•å†…å®¹**ï¼š
1. âœ“ æ‰€æœ‰ Python æ¨¡å—å¯¼å…¥
2. âœ“ CUDA/BF16/FP16 æ£€æµ‹
3. âœ“ æ¨¡å‹åŠ è½½ä¸ç»“æ„éªŒè¯
4. âœ“ HeadGate åŠŸèƒ½æµ‹è¯•
5. âœ“ å·¥å…·å‡½æ•°æµ‹è¯•

---

## âš™ï¸ æˆ‘æƒ³æŸ¥çœ‹é…ç½®è¯´æ˜

ğŸ‘‰ **[configs/mnli.yaml](configs/mnli.yaml)**
- è®­ç»ƒè¶…å‚æ•°å‚è€ƒ
- Eval subset è®¾ç½®
- æµ‹é‡é…ç½®
- åˆ†æé˜ˆå€¼

**æ³¨æ„**ï¼šå½“å‰é…ç½®æ–‡ä»¶ä»…ä¾›å‚è€ƒï¼Œå®é™…è¿è¡Œä½¿ç”¨è„šæœ¬ä¸­çš„å‚æ•°ã€‚

---

## ğŸ› ï¸ æˆ‘æƒ³è°ƒè¯•æˆ–å®šåˆ¶å®éªŒ

### æŸ¥çœ‹è„šæœ¬
- **è®­ç»ƒ**ï¼š[scripts/run_mnli.sh](scripts/run_mnli.sh)
- **æµ‹é‡**ï¼š[scripts/measure_mnli.sh](scripts/measure_mnli.sh)
- **å¯è§†åŒ–**ï¼š[scripts/make_plots.sh](scripts/make_plots.sh)

### æŸ¥çœ‹æ ¸å¿ƒä»£ç 
- **æ•°æ®åŠ è½½**ï¼š[src/data/glue.py](src/data/glue.py)
- **æ¨¡å‹ Gate**ï¼š[src/model/deberta_head_gating.py](src/model/deberta_head_gating.py)
- **è®­ç»ƒ**ï¼š[src/train/finetune_glue.py](src/train/finetune_glue.py)
- **é‡è¦æ€§**ï¼š[src/measure/importance_ablation.py](src/measure/importance_ablation.py)
- **æ¢¯åº¦/Fisher**ï¼š[src/measure/grad_fisher_gate.py](src/measure/grad_fisher_gate.py)
- **æ›´æ–°é‡**ï¼š[src/measure/update_magnitude.py](src/measure/update_magnitude.py)
- **æ±‡æ€»**ï¼š[src/analysis/aggregate.py](src/analysis/aggregate.py)
- **å¯è§†åŒ–**ï¼š[src/analysis/plots.py](src/analysis/plots.py)

---

## â“ æˆ‘é‡åˆ°äº†é—®é¢˜

### æ­¥éª¤ 1ï¼šæŸ¥çœ‹å¸¸è§é—®é¢˜
ğŸ‘‰ **[README.md Â§ å¸¸è§é—®é¢˜æ’æŸ¥](README.md#å¸¸è§é—®é¢˜æ’æŸ¥)**
- Gate hook æœªç”Ÿæ•ˆ
- View/reshape æŠ¥é”™
- MNLI split åç§°é”™è¯¯
- BF16/FP16 åˆ‡æ¢å¤±è´¥
- è¿è¡Œæ—¶é—´è¿‡é•¿
- æ¨¡å‹ç»“æ„ä¸åŒ¹é…

### æ­¥éª¤ 2ï¼šè¿è¡Œç¯å¢ƒæµ‹è¯•
```bash
python test_setup.py
```

### æ­¥éª¤ 3ï¼šæŸ¥çœ‹è°ƒè¯•æŠ€å·§
ğŸ‘‰ **[QUICKSTART.md Â§ è°ƒè¯•æŠ€å·§](QUICKSTART.md#è°ƒè¯•æŠ€å·§)**
- æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
- æ‰‹åŠ¨æµ‹è¯•å•ä¸ªæ­¥éª¤

---

## ğŸ“ˆ å®éªŒæµç¨‹å›¾

```
1. è®­ç»ƒ (run_mnli.sh)
   â”œâ”€ åŠ è½½ DeBERTa-v3-base
   â”œâ”€ å¾®è°ƒ MNLIï¼ˆ3 epochsï¼‰
   â”œâ”€ ä¿å­˜ Î¸0 (ckpt_init)
   â””â”€ ä¿å­˜ Î¸1 (ckpt_final)
        â†“
2. æµ‹é‡ (measure_mnli.sh)
   â”œâ”€ å›ºå®š eval subset (1024, seed=999)
   â”œâ”€ é‡è¦æ€§ï¼ˆÎ¸0ï¼‰â†’ importance_pre.jsonl
   â”œâ”€ æ¢¯åº¦/Fisherï¼ˆÎ¸0ï¼‰â†’ gradfisher_pre.jsonl
   â”œâ”€ æ›´æ–°é‡ï¼ˆÎ¸1-Î¸0ï¼‰â†’ update.jsonl
   â””â”€ é‡è¦æ€§ï¼ˆÎ¸1ï¼‰â†’ importance_post.jsonl
        â†“
3. å¯è§†åŒ– (make_plots.sh)
   â”œâ”€ æ±‡æ€» â†’ heads.csv
   â”œâ”€ ç»Ÿè®¡ â†’ stats.json
   â”œâ”€ åä¾‹ â†’ cases.json
   â”œâ”€ å›¾1 â†’ fig_I_vs_U.png
   â”œâ”€ å›¾2 â†’ fig_I_vs_G.png
   â””â”€ å›¾3 â†’ fig_stats.png
```

---

## ğŸ¯ æ ¸å¿ƒè¾“å‡ºè¯´æ˜

### åä¾‹é›†åˆï¼ˆcases.jsonï¼‰
- **important-but-static**ï¼šI_pre top 10% ä¸” Urel bottom 30%
  - è¯´æ˜ï¼šé‡è¦ä½†ä¸æ›´æ–°çš„ head
- **plastic-but-unimportant**ï¼šUrel top 10% ä¸” I_pre bottom 30%
  - è¯´æ˜ï¼šæ›´æ–°å¤§ä½†ä¸é‡è¦çš„ head

### ç»Ÿè®¡æŒ‡æ ‡ï¼ˆstats.jsonï¼‰
- **spearman_rho_Ipre_U**ï¼šSpearman ç§©ç›¸å…³ï¼ˆæœŸæœ› < 0.5ï¼‰
- **topk_overlap_Ipre_U**ï¼štop-20 é‡å åº¦ï¼ˆæœŸæœ› < 0.3ï¼‰
- **n_important_but_static**ï¼šåä¾‹ A æ•°é‡ï¼ˆæœŸæœ› â‰¥ 3ï¼‰
- **n_plastic_but_unimportant**ï¼šåä¾‹ B æ•°é‡ï¼ˆæœŸæœ› â‰¥ 3ï¼‰

### æ±‡æ€»è¡¨ï¼ˆheads.csvï¼‰
```
layer,head,I_pre,I_post,U,Urel,G,F,Ppred,Uq,Uk,Uv,Uo
0,0,0.015,0.012,0.8,0.003,0.02,0.001,0.4,...
...
11,11,0.008,0.006,1.2,0.005,0.03,0.002,0.45,...
```

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

### æœ€å¸¸ç”¨å‘½ä»¤
```bash
# è¿è¡Œå®Œæ•´å®éªŒï¼ˆseed=1ï¼‰
bash scripts/run_mnli.sh 1
bash scripts/measure_mnli.sh 1
bash scripts/make_plots.sh 1

# æŸ¥çœ‹ç»“æœ
cat outputs/MNLI/seed1/stats.json
cat outputs/MNLI/seed1/cases.json

# æµ‹è¯•ç¯å¢ƒ
python test_setup.py
```

### è¾“å‡ºè·¯å¾„
```
outputs/MNLI/seed{seed}/
â”œâ”€â”€ ckpt_init/               # Î¸0
â”œâ”€â”€ ckpt_final/              # Î¸1
â”œâ”€â”€ eval_subset.json         # å›ºå®š subset
â”œâ”€â”€ importance_pre.jsonl     # é‡è¦æ€§ï¼ˆå¾®è°ƒå‰ï¼‰
â”œâ”€â”€ gradfisher_pre.jsonl     # æ¢¯åº¦ä¸ Fisher
â”œâ”€â”€ update.jsonl             # æ›´æ–°é‡
â”œâ”€â”€ importance_post.jsonl    # é‡è¦æ€§ï¼ˆå¾®è°ƒåï¼‰
â”œâ”€â”€ heads.csv                # æ±‡æ€»è¡¨
â”œâ”€â”€ stats.json               # ç»Ÿè®¡æŒ‡æ ‡
â”œâ”€â”€ cases.json               # åä¾‹é›†åˆ
â””â”€â”€ fig_*.png                # ä¸‰å¼ å›¾
```

---

## ğŸ“ æ–‡æ¡£æ›´æ–°æ—¥å¿—

- **2026-01-16**ï¼šé¡¹ç›®åˆå§‹ç”Ÿæˆ
  - 27 ä¸ªæ–‡ä»¶å…¨éƒ¨ç”Ÿæˆ
  - 5 ä¸ªæ–‡æ¡£æ–‡ä»¶ï¼ˆREADME, QUICKSTART, CHECKLIST, PROJECT_FILES, SUMMARYï¼‰
  - å®Œæ•´åŠŸèƒ½å®ç°ä¸éªŒè¯

---

**å½“å‰ç‰ˆæœ¬**ï¼šv1.0  
**ç”Ÿæˆæ—¶é—´**ï¼š2026-01-16  
**é¡¹ç›®è·¯å¾„**ï¼š`/data1/shenth/work/MI_plasticity/minimal-exp`

ç¥å®éªŒé¡ºåˆ©ï¼ğŸ‰
